# Prometheus Configuration Example
# ============================================================================
# Scrape config for ECS/ALB/Node exporters.
# For ECS service discovery, use AWS Cloud Map or file-based SD.
# ============================================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: claude-proxy
    environment: REPLACE_ME_ENV

scrape_configs:
  # Application metrics
  - job_name: 'claude-proxy-api'
    static_configs:
      - targets: ['REPLACE_ME_API_HOST:8000']
    metrics_path: /metrics
    scheme: http

  # ALB Exporter (if using)
  - job_name: 'alb-exporter'
    static_configs:
      - targets: ['REPLACE_ME_ALB_EXPORTER:9199']

  # Node Exporter (for EC2 path)
  # - job_name: 'node-exporter'
  #   ec2_sd_configs:
  #     - region: REPLACE_ME_REGION
  #       port: 9100
  #   relabel_configs:
  #     - source_labels: [__meta_ec2_tag_Name]
  #       target_label: instance

  # ECS Service Discovery (via file-based SD)
  - job_name: 'ecs-tasks'
    file_sd_configs:
      - files:
          - /etc/prometheus/ecs_targets.json
        refresh_interval: 30s
    relabel_configs:
      - source_labels: [__meta_ecs_task_family]
        target_label: task_family
      - source_labels: [__meta_ecs_container_name]
        target_label: container

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['REPLACE_ME_ALERTMANAGER:9093']

rule_files:
  - /etc/prometheus/rules/*.yml
